!function(t){t.wikilookup||(t.wikilookup={})}(jQuery),jQuery.wikilookup.tools={getPropValue:function(t,e){for(var i=t||{},s=0;i=i[e[s]],s++,i&&s<e.length;);return i}},function(a){function t(t){t=t||{},this.cache={},this.promises={},this.standardURLs={restBase:"https://{{lang}}.wikipedia.org/api/rest_v1/page/summary/{{pageName}}",api:"https://{{lang}}.wikipedia.org/w/api.php"},this.lang=t.lang||"en",this.useRestbase=!!t.useRestbase,this.baseURL=t.baseURL,this.baseURL||(this.baseURL=this.useRestbase?this.standardURLs.restBase:this.standardURLs.api),this.isWikipedia=!!this.baseURL.match(/https:\/\/(.+)\.wikipedia.org/)}t.prototype.getPageInfo=function(e,t){var i=this,s=this.getCacheKey(e);return this.cache[s]?a.Deferred().resolve(this.cache[s]):this.promises[s]?this.promises[s]:this.fetch(e,t).then(function(t){return i.updateCache(e,t),t})},t.prototype.fetch=function(t,e){var i,s=this,r=this.getCacheKey(t);return i=a.ajax(this.getApiParams(t,e)).then(function(t){return s.promises[r]=null,s.processApiResult(t)},function(){return s.promises[r]=null,"error"}).then(function(t){return s.promises[r]=null,"error"===t||"missing"===t?a.Deferred().reject(t):t}),this.promises[r]=i},t.prototype.processApiResult=function(t){var e,i;return t?this.useRestbase?"https://mediawiki.org/wiki/HyperSwitch/errors/not_found"===t.type?"missing":{title:t.displaytitle,content:t.extract,thumbnail:t.thumbnail||{},url:t.content_urls.desktop.page,history:t.content_urls.desktop.revisions,dir:t.dir||"ltr",wikipedia:this.isWikipedia}:(e=(i=a.wikilookup.tools.getPropValue(t,["query","pages"]))[Object.keys(i)[0]])?void 0!==e.missing?"missing":{title:e.title,content:e.extract,thumbnail:e.thumbnail,url:e.canonicalurl,history:e.fullurl+"?action=history",dir:e.pagelanguagedir||"ltr",wikipedia:this.isWikipedia}:"error":"error"},t.prototype.updateCache=function(t,e){this.cache[this.getCacheKey(t)]=e},t.prototype.getCacheKey=function(t){return t.trim().toLowerCase().replace(new RegExp(/\s/g),"_")},t.prototype.getApiParams=function(t,e){var i=this.baseURL;return i=i.replace("{{lang}}",encodeURIComponent(e||this.lang)).replace("{{pageName}}",encodeURIComponent(t)),this.useRestbase?{url:i,data:{redirect:!0}}:{url:i,dataType:"jsonp",data:{action:"query",format:"json",prop:"info|pageimages|extracts",titles:t,inprop:"url",piprop:"thumbnail",pithumbsize:300,redirects:"1",explaintext:"1",exintro:"1"}}},a.wikilookup.Api=t}(jQuery),function(e){function t(t){t=e.extend({},t),this.$element=t.$element||e("<div>"),this.messages=e.extend({},{articleHistory:"Contribution history",articleLink:"Go to the original article",wikimediaIntro:"Help us improve Wikipedia",wikimediaParticipate:"Participate",wikimediaSupport:"Support"},t.messages),this.$articleHistory=e("<a>").addClass("wl-footerWidget-articleHistory-link").attr("target","_blank").html(e.parseHTML(this.messages.articleHistory)),this.$articleLink=e("<a>").addClass("wl-footerWidget-articleLink-link").attr("target","_blank").html(e.parseHTML(this.messages.articleLink)),this.$element.addClass("wl-footerWidget").append(e("<div>").addClass("wl-footerWidget-articleHistory").append(this.$articleHistory),e("<div>").addClass("wl-footerWidget-articleLink").append(this.$articleLink),e("<div>").addClass("wl-footerWidget-wikimedia").append(e("<div>").addClass("wl-footerWidget-wikimedia-intro").text(this.messages.wikimediaIntro),e("<div>").addClass("wl-footerWidget-wikimedia-participate").append(e("<a>").attr("target","_blank").attr("href","https://wikimediafoundation.org/participate/").text(this.messages.wikimediaParticipate)),e("<div>").addClass("wl-footerWidget-wikimedia-support").append(e("<a>").attr("target","_blank").attr("href","https://wikimediafoundation.org/support/").text(this.messages.wikimediaSupport))))}t.prototype.updateHistoryLink=function(t){this.$articleHistory.attr("href",t)},t.prototype.updateArticleLink=function(t){this.$articleLink.attr("href",t)},e.wikilookup.FooterWidget=t}(jQuery),function(e){function t(t){t=t||{},this.$element=t.$element||e("<div>"),this.messages=e.extend({},{link:"Read more",pending:"Loading...",error:"There was a problem loading this page information."},t.messages),this.$pending=this.buildPending(),this.$view=this.buildView(),this.$error=this.buildError(),this.footer=new e.wikilookup.FooterWidget({messages:this.messages}),this.setState("pending"),this.$element.addClass("wl-pageInfoWidget").append(this.$pending,this.$error,this.$view,this.footer.$element)}t.prototype.setState=function(e){var t=["pending","ready","error"];this.state!==e&&-1<t.indexOf(e)&&(t.forEach(function(t){this.$element.toggleClass("wl-pageInfoWidget-state-"+t,e===t)}.bind(this)),this.state=e)},t.prototype.getState=function(){return this.state},t.prototype.buildView=function(){return this.$title=e("<div>").addClass("wl-pageInfoWidget-view-title"),this.$content=e("<div>").addClass("wl-pageInfoWidget-view-content"),this.$thumb=e("<div>").addClass("wl-pageInfoWidget-view-thumb"),this.$link=e("<a>").addClass("wl-pageInfoWidget-view-link").attr("target","_blank").append(this.messages.link),e("<div>").addClass("wl-pageInfoWidget-content-ready").append(e("<div>").addClass("wl-pageInfoWidget-box").append(this.$title,this.$content,this.$link),e("<div>").addClass("wl-pageInfoWidget-box").append(this.$thumb))},t.prototype.setData=function(t){t=e.extend({thumbnail:{}},t),this.$title.text(t.title),this.$content.text(t.content),this.$thumb.css({backgroundImage:"url( "+t.thumbnail.source+" )",width:t.thumbnail.width,height:"100%",backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundPosition:"center"}),this.$link.attr("href",t.url),this.$element.attr("dir",t.dir||"ltr"),this.footer.updateHistoryLink(t.history),this.footer.updateArticleLink(t.url),this.$element.toggleClass("wl-pageInfoWidget-wikipedia",!!t.wikipedia)},t.prototype.buildPending=function(){return e("<div>").addClass("wl-pageInfoWidget-content-pending").append(this.messages.pending)},t.prototype.buildError=function(){return e("<div>").addClass("wl-pageInfoWidget-content-error").append(this.messages.error)},e.wikilookup.PageInfoWidget=t}(jQuery),function(s){function t(t,e){if(e=e||{},this.$container=t,!this.$container||!this.$container.length)throw new Error("wikilookup initialization error: Could not process given element.");this.prefetch=!!e.prefetch,this.selector=e.selector||"[data-wikilookup]",this.messages=e.messages||{},this.$nodes=s(),this.sources={},this.trigger=null,this.initializeNodes(),this.initializeSources(e.sources),this.setUpdateTrigger(e.trigger),e.prefetch&&this.updateAllNodes()}t.prototype.updateAllNodes=function(){var t=this;this.getNodes().each(function(){t.updateWidget(s(this))})},t.prototype.initializeNodes=function(){var i=this;this.$nodes=this.$container.find(this.selector).filter(function(){return!!(s(this).attr("data-wl-title")||s(this).text()).trim()}),this.$nodes.each(function(){var t,e=s(this).attr("data-wl-title")||s(this).text();s(this).attr("data-wl-title",e.trim()),t=new s.wikilookup.PageInfoWidget({messages:i.messages}),s(this).data("wl-widget",t)})},t.prototype.getSource=function(t){return t=t||"default",this.sources[t]||(t="default"),this.sources[t]},t.prototype.initializeSources=function(t){var e;for(e in t=s.extend({},t),this.sources={default:new s.wikilookup.Api},t)this.sources[e]=new s.wikilookup.Api(t[e])},t.prototype.setUpdateTrigger=function(t){var e=this;-1===["click","mouseenter"].indexOf(t)&&(t="click"),this.trigger!==t&&(this.getNodes().each(function(){e.trigger&&e.trigger!==t&&s(this).off(e.trigger+".wikilookupEvent"),s(this).on(t+".wikilookupEvent",e.onTriggerEvent.bind(e,s(this)))}),this.trigger=t)},t.prototype.updateWidget=function(t){var e=t.attr("data-wl-title"),i=t.attr("data-wl-source")||"default",s=t.attr("data-wl-lang"),r=t.data("wl-widget"),a=!!t.data("wl-state-fetching"),o=this.getSource(i);a||(o?"ready"!==r.getState()&&(t.data("wl-state-fetching",!0),o.getPageInfo(e,s).then(function(t){r.setData(t),r.setState("ready")},function(){r.setState("error")}).always(function(){t.data("wl-state-fetching",!1)})):console.error('wikilookup error: Could not recognize source "'+i+'".'))},t.prototype.onTriggerEvent=function(t){this.updateWidget(t)},t.prototype.getNodes=function(){return this.$nodes},t.prototype.getAllTerms=function(){var t=[];return this.$nodes.each(function(){t.push(s(this).attr("data-wl-title"))}),t},s.wikilookup.Processor=t}(jQuery),function(i){i.fn.wikilookup=function(t){var e=new i.wikilookup.Processor(i(this),t);i(this).data("wl-processor",e)}}(jQuery);